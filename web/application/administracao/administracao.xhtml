<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:p="http://primefaces.org/ui">

    <h:form id="frmAdministracao">
        <center> 
            <p:panel class="forms" style="width: 80%;">
                <p class="title">#{psychoManager.Administracao}</p>

                <p:panelGrid columns="3">
                    <p:panelGrid columns="1">
                        <p:autoComplete id="buscarNomePaciente" 
                                        value="#{administracaoHandler.pacientesPartNameBean.nomePaciente}" 
                                        completeMethod="#{administracaoHandler.pacientesPartNameBean.getListaPacientesPartName}" 
                                        minQueryLength="2"
                                        queryDelay="500"
                                        cache="true" 
                                        cacheTimeout="30000"
                                        inputStyle="width: 300px"
                                        pt:placeholder="#{psychoManager.Paciente}"
                                        pt:autofocus="">
                            <p:ajax event="itemSelect" listener="#{administracaoHandler.pacientesPartNameBean.onItemSelect}" />
                        </p:autoComplete>

                        <p:panelGrid columns="2">
                            <p:outputLabel value="#{psychoManager.De}" />
                            <p:calendar id="calendarDe"
                                        value="#{administracaoHandler.calendarPeriodBean.selectedDateDe}"  
                                        locale="#{languageHandler.locale}"
                                        pattern="dd/MM/yyyy" 
                                        mask="true"
                                        disabled="#{administracaoHandler.calendarPeriodBean.disabled}"
                                        required="true"
                                        requiredMessage="#{psychoManager.EscolhaUmaDataInicial}">
                            </p:calendar>                            

                            <p:outputLabel value="#{psychoManager.Ate}" />
                            <p:calendar id="calendarAte"
                                        value="#{administracaoHandler.calendarPeriodBean.selectedDateAte}"  
                                        locale="#{languageHandler.locale}"
                                        pattern="dd/MM/yyyy" 
                                        mask="true"
                                        disabled="#{administracaoHandler.calendarPeriodBean.disabled}"
                                        required="true"
                                        requiredMessage="#{psychoManager.EscolhaUmaDataFinal}">
                            </p:calendar>                            
                        </p:panelGrid>  
                    </p:panelGrid>                                    

                    <p:panelGrid columns="2">
                        <p:outputLabel value="#{psychoManager.Produto}" />
                        <p:selectOneMenu value="#{administracaoHandler.idProduto}" >
                            <f:selectItems value="#{administracaoHandler.carregarProdutos()}" 
                                           var="prod" 
                                           itemValue="#{prod.idProduto}" 
                                           itemLabel="#{prod.dsNome}" />
                        </p:selectOneMenu>

                        <p:outputLabel value="#{psychoManager.Presenca}" />
                        <p:selectOneButton value="#{administracaoHandler.presenca}" >
                            <f:selectItems value="#{administracaoHandler.carregarOpcoesPresenca()}" 
                                           var="prod" 
                                           itemValue="#{prod.id}" 
                                           itemLabel="#{prod.descricao}" />
                        </p:selectOneButton>

                        <p:outputLabel value="#{psychoManager.Pagamento}" />
                        <p:selectOneButton value="#{administracaoHandler.pago}" >
                            <f:selectItems value="#{administracaoHandler.carregarStatusPago()}" 
                                           var="prod" 
                                           itemValue="#{prod.id}" 
                                           itemLabel="#{prod.descricao}" />
                        </p:selectOneButton>
                        <p:outputLabel value="#{psychoManager.OrdenarPor}" />
                        <p:selectOneButton value="#{administracaoHandler.ordenarPor}" >
                            <f:selectItems value="#{administracaoHandler.ordenarPor()}" 
                                           var="prod" 
                                           itemValue="#{prod.id}" 
                                           itemLabel="#{prod.descricao}" />
                        </p:selectOneButton>
                    </p:panelGrid>         
                    <p:panelGrid columns="2">
                        <p:commandLink id="go" action="#{administracaoHandler.consultar}" update="table,info" title="#{psychoManager.Localizar}">
                            <h:graphicImage library="default" name="images/views.png"/>
                        </p:commandLink> 
                    </p:panelGrid>
                </p:panelGrid>                                    
                <!--<p:growl id="messages" showDetail="false" autoUpdate="true" />-->
                <p:growl id="messages" showDetail="false" />

                <p:outputPanel id="info" styleClass="ui-outputPanel-message-tela-administracao">
                    <p:outputLabel value="#{administracaoHandler.resultadoConsulta}" rendered="#{administracaoHandler.consultaRealizada}"/>
                </p:outputPanel>

                <p:outputPanel id="out">
                    <p:dataTable value="#{administracaoHandler.consultas}" 
                                 var="item" 
                                 id="table" 
                                 widgetVar="agendaTable" 
                                 emptyMessage="" 
                                 filteredValue="#{administracaoHandler.filteredAgenda}"
                                 paginator="true"
                                 rows="30">

                        <p:column headerText="#{psychoManager.Data}" sortBy="#{item.tbAgendaPK.dtConsulta}">
                            <p:outputLabel value="#{item.tbAgendaPK.dtConsulta}">
                                <f:convertDateTime pattern="dd/MM/yyyy - HH:mm" timeZone="#{administracaoHandler.timezone}"/>
                            </p:outputLabel>
                        </p:column>

                        <!--                        <p:column filterBy="{item.getTbPaciente().dsNome}" headerText="{psychoManager.NomePaciente}" filterMatchMode="exact" style="width: 22%">
                                                    <f:facet name="filter">
                                                        <p:selectOneMenu onchange="PF('agendaTable').filter()" >
                                                            <f:selectItem itemLabel="" itemValue="{null}" noSelectionOption="true" />
                                                            <f:selectItems value="{administracaoHandler.filtroPaciente}" />
                                                        </p:selectOneMenu>
                                                    </f:facet>
                                                    <h:outputText value="#{item.getTbPaciente().dsNome}" />
                                                </p:column>-->
                        <p:column headerText="#{psychoManager.NomePaciente}" sortBy="#{item.getTbPaciente().dsNome}" style="width: 22%">
                            <h:outputText value="#{item.getTbPaciente().dsNome}" />
                        </p:column>

                        <p:column style="width: 130px">
                            <f:facet name="header">
                                <p:outputLabel value="#{psychoManager.Produto}"/>
                            </f:facet>
                            <p:selectOneMenu value="#{item.idProduto}" >
                                <f:selectItems value="#{administracaoHandler.carregarProdutos()}" 
                                               var="prod" 
                                               itemValue="#{prod.idProduto}" 
                                               itemLabel="#{prod.dsNome}" />
                            </p:selectOneMenu>
                        </p:column>

                        <p:column style="width: 60px">
                            <f:facet name="header">
                                <p:outputLabel value="#{psychoManager.Presenca}"/>
                            </f:facet>
                            <p:selectBooleanCheckbox value="#{item.stPresenca}">
                            </p:selectBooleanCheckbox>
                        </p:column>

                        <p:column style="width: 120px">
                            <f:facet name="header">
                                <p:outputLabel value="#{psychoManager.Pago}"/>
                            </f:facet>
                            <p:selectOneMenu value="#{item.stPagamento}">
                                <f:selectItems value="#{administracaoHandler.carregarOpcoesPago()}" 
                                               var="prod" 
                                               itemValue="#{prod.id}" 
                                               itemLabel="#{prod.descricao}" />
                            </p:selectOneMenu>
                        </p:column>

                        <p:column style="width: 100px">
                            <f:facet name="header">
                                <p:outputLabel value="#{psychoManager.Preco}"/>
                            </f:facet>
                            <p:inputNumber id="preco1"
                                           styleClass="ui-inputNumber-tela-administracao"
                                           value="#{item.vlPreco}" 
                                           decimalSeparator="," 
                                           thousandSeparator="."
                                           symbol="#{psychoManager.$} " 
                                           pt:placeholder="#{psychoManager.$}"/>                             
                        </p:column>

                        <!--                        <p:column filterBy="{item.dsObs}" headerText="{psychoManager.Observacao}" filterMatchMode="exact">
                                                    <f:facet name="filter">
                                                        <p:selectOneMenu onchange="PF('agendaTable').filter()" >
                                                            <f:selectItem itemLabel="" itemValue="{null}" noSelectionOption="true" />
                                                            <f:selectItems value="{administracaoHandler.filtroObservacao}" />
                                                        </p:selectOneMenu>
                                                    </f:facet>
                                                    <h:outputText value="{item.dsObs}" />
                                                </p:column>-->
                        <p:column headerText="#{psychoManager.Observacao}" sortBy="#{item.dsObs}">
                            <h:outputText value="#{item.dsObs}" />
                        </p:column>

                        <p:column style="width: 10px;">
                            <p:commandLink onclick="setAgendaParaGravar([{name: 'idPaciente', value: '#{item.tbPaciente.idPaciente}'}, {name: 'dtConsulta', value: '#{item.tbAgendaPK.dtConsulta}'}]);" 
                                           action="#{administracaoHandler.gravar()}" 
                                           title="#{psychoManager.Gravar}" 
                                           update="table">
                                <p:graphicImage library="default" name="images/save.png"/>
                            </p:commandLink> 
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>                
            </p:panel>
        </center>   
        <p:remoteCommand name="setAgendaParaGravar" 
                         action="#{administracaoHandler.setParamAgendaGravar()}" >
        </p:remoteCommand> 
    </h:form>
</ui:composition>