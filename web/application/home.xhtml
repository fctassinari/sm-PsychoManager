<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">


    <h:form id="frmHome"> 
        <center>
            <p:outputPanel class="forms" style="width: 80%">
                <p class="title">#{psychoManager.Agenda}</p>

                <p:growl id="messages" showDetail="true" />

                <p:schedule id="schedule" 
                            aspectRatio="2.5"
                            scrollTime="8:00"
                            value="#{scheduleViewHandler.lazyEventModel}"
                            widgetVar="myschedule" 
                            timeZone="#{scheduleViewHandler.timezone}"
                            class="schedule"
                            view="agendaWeek"
                            columnFormat="#{psychoManager.columnFormat}"
                            timeFormat="#{psychoManager.timeFormat}"
                            axisFormat="#{psychoManager.axisFormat}"
                            allDaySlot="false"
                            locale="#{languageHandler.getLanguageForAgenda()}">
                    <p:ajax event="dateSelect" listener="#{scheduleViewHandler.onDateSelect}" update="eventDetails" oncomplete="PF('eventDialog').show();" />
                    <p:ajax event="eventSelect" listener="#{scheduleViewHandler.onEventSelect}" update="eventDetails" oncomplete="PF('eventDialog').show();" />
                    <p:ajax event="eventMove" listener="#{scheduleViewHandler.onEventMove}" update="messages" />
                    <p:ajax event="eventResize" listener="#{scheduleViewHandler.onEventResize}" update="messages" />
                </p:schedule>
                
                
                <p:dialog id="evento" 
                          position="top" 
                          styleClass="dialog"
                          widgetVar="eventDialog" 
                          header="#{psychoManager.Compromisso}" 
                          showEffect="clip" 
                          hideEffect="clip"   >
                    <p:panelGrid id="eventDetails" columns="2">     
                        <p:outputLabel for="title" value="#{psychoManager.Paciente}" />
                        <p:autoComplete id="title" 
                                        disabled="#{!scheduleViewHandler.isNovo()}"
                                        value="#{scheduleViewHandler.pacientesPartNameBean.nomePaciente}" 
                                        completeMethod="#{scheduleViewHandler.pacientesPartNameBean.getListaPacientesPartName}" 
                                        minQueryLength="2"
                                        queryDelay="500"
                                        cache="true" 
                                        cacheTimeout="30000"
                                        inputStyle="width: 280px"
                                        pt:placeholder="#{psychoManager.Paciente}"
                                        pt:autofocus="" >
                            <p:ajax event="itemSelect" listener="#{scheduleViewHandler.pacientesPartNameBean.onItemSelect}" update="valor, preco"/>
                        </p:autoComplete>                            

                        <p:outputLabel value="#{psychoManager.Produto}" />
                        <p:selectOneMenu id="xx"  value="#{scheduleViewHandler.idProduto}">
                            <p:ajax listener="#{scheduleViewHandler.onProdutoChange}" update="valor, preco" />
                            <f:selectItems value="#{scheduleViewHandler.carregarProdutos()}" 
                                           var="prod" 
                                           itemValue="#{prod.idProduto}" 
                                           itemLabel="#{prod.dsNome}" 
                                           />
                        </p:selectOneMenu>
                        <p:outputLabel value="" />
                        <p:inputNumber id="valor"
                                       disabled="true"
                                       value="#{scheduleViewHandler.valorProduto}" 
                                       decimalSeparator="," 
                                       thousandSeparator="."
                                       symbol="#{psychoManager.$} " 
                                       pt:placeholder="#{psychoManager.$}"/> 

                        <p:outputLabel value="#{psychoManager.CobrarOutroValor}" /> 
                        <p:inputNumber id="preco"
                            value="#{scheduleViewHandler.precoDigitado}" 
                            decimalSeparator="," 
                            thousandSeparator="."
                            symbol="#{psychoManager.$} " 
                             pt:placeholder="#{psychoManager.$}"/>

                        <p:outputLabel value="#{psychoManager.Observacao}" />
                        <p:inputText id="dsObs" style="width: 280px"
                                     value="#{scheduleViewHandler.observacao}" 
                                     maxlength="100" 
                                     pt:placeholder="#{psychoManager.Observacao}"/>                                            

                        <p:outputLabel for="presenca" value="#{psychoManager.ConfirmarPresenca}" />
                        <p:selectBooleanCheckbox id="presenca" value="#{scheduleViewHandler.presenca}" style="width: 50" />

                        <p:outputLabel value="#{psychoManager.Pagamento}" />
                        <p:selectOneButton value="#{scheduleViewHandler.pago}">
                            <f:selectItems value="#{administracaoHandler.carregarOpcoesPago()}" 
                                           var="pg" 
                                           itemValue="#{pg.id}" 
                                           itemLabel="#{pg.descricao}" />
                        </p:selectOneButton>

                        <p:outputLabel for="from" value="#{psychoManager.Inicio}" />
                        <p:calendar id="from" value="#{scheduleViewHandler.event.startDate}" timeZone="#{scheduleViewHandler.timezone}" pattern="dd/MM/yyyy HH:mm"/>                       

                        <p:outputLabel for="to" value="#{psychoManager.Fim}" />
                        <p:calendar id="to" value="#{scheduleViewHandler.event.endDate}" timeZone="#{scheduleViewHandler.timezone}" pattern="dd/MM/yyyy HH:mm" />

                        <p:outputLabel value="Repetir" rendered="#{scheduleViewHandler.isNovo()}"/>
                        <p:panelGrid columns="1">
                            <p:inputText id="dias" 
                                         rendered="#{scheduleViewHandler.isNovo()}"
                                         value="#{scheduleViewHandler.qtdDiasRepetir}" 
                                         maxlength="3" 
                                         style="width: 100px"
                                         pt:placeholder="#{psychoManager.Dias}"/>
                            <p:inputText id="vezes" 
                                         rendered="#{scheduleViewHandler.isNovo()}"
                                         value="#{scheduleViewHandler.qtdVezesRepetir}" 
                                         maxlength="3" 
                                         style="width: 100px" 
                                         pt:placeholder="#{psychoManager.Vezes}"/>
                        </p:panelGrid>

                        <p:panel class="pnlButton" >
                            <p:panelGrid columns="3" >
                                <p:commandButton id="addButton" 
                                                 value="#{psychoManager.Gravar}" 
                                                 actionListener="#{scheduleViewHandler.addEvent}" 
                                                 oncomplete="PF('myschedule').update();" 
                                                 update="messages" />

                                <p:commandButton id="deleteButton" 
                                                 value="#{psychoManager.Apagar}" 
                                                 actionListener="#{scheduleViewHandler.deleteEvent}"  
                                                 onclick="if (!confirm('#{psychoManager.DesejaRealmenteExcluirEstaInformacao}?'))
                                                             return false;" 
                                                 oncomplete="PF('myschedule').update();PF('eventDialog').hide();" 
                                                 rendered="#{!scheduleViewHandler.isNovo()}"/>

                                <p:commandButton id="closeButton" 
                                                 value="#{psychoManager.Fechar}" 
                                                 onclick="PF('eventDialog').hide();" />
                            </p:panelGrid>
                        </p:panel>


                    </p:panelGrid>
                </p:dialog>    
            </p:outputPanel>
        </center>      
    </h:form>
</ui:composition>
